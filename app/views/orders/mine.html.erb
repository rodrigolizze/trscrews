<!-- app/views/orders/mine.html.erb -->

<div class="container py-4">
  <h1 class="h4 mb-3">Meus pedidos</h1>

  <%# // Empty state: show a friendly message if user has no orders %>
  <% if @orders.blank? %>
    <div class="alert alert-info mb-3">
      Você ainda não tem pedidos.
    </div>
    <%= link_to "Ir para o catálogo", screws_path, class: "btn btn-yellow" %>
  <% else %>

    <%# // Table with basic order info %>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Pedido</th>
            <th>Status</th>
            <th>Data</th>
            <th class="text-end">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @orders.each do |order| %>
            <%# // Compute a human-friendly code; if you already have a code field, use it here %>
            <% code = order.try(:code).presence || "##{order.id}" %>

            <%# // Choose a badge color based on status %>
            <% status = (order.respond_to?(:payment_status) ? order.payment_status.to_s : (order.paid_at.present? ? "paid" : "pending")) %>
            <% badge_class =
                 case status
                 when "paid"       then "bg-success"
                 when "pending"    then "bg-warning text-dark"
                 when "cancelled"  then "bg-secondary"
                 else                    "bg-light text-dark"
                 end %>

            <%# // You likely have subtotal/shipping/total persisted; fall back to simple calc if needed %>
            <% total = if order.respond_to?(:total) && order.total.present?
                         order.total
                       else
                         (order.order_items.sum(:line_total).to_d) + (order.try(:shipping).to_d || 0)
                       end %>

            <tr>
              <td><strong><%= code %></strong></td>
              <td><span class="badge <%= badge_class %>"><%= status %></span></td>
              <td><%= l(order.created_at, format: :short) %></td>
              <td class="text-end"><%= format_price(total) %></td>
              <td class="text-end">
                <%= link_to "Ver detalhes", order_path(order), class: "btn btn-sm btn-outline-dark" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <%# // Optional: quick link back to catalog %>
    <div class="mt-3">
      <%= link_to "Continuar comprando", screws_path, class: "btn btn-outline-secondary" %>
    </div>

  <% end %>
</div>

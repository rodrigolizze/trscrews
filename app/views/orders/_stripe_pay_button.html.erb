<%# // Reusable Stripe Checkout button for an order (@order must be set) %>

<%# // Optional success/cancel hints via URL params from Checkout redirect %>
<% if params[:paid].present? %>
  <div class="alert alert-success mb-3">
    Pagamento em processamento. Você receberá a confirmação por email.
  </div>
<% elsif params[:canceled].present? %>
  <div class="alert alert-warning mb-3">
    Pagamento cancelado. Você pode tentar novamente abaixo.
  </div>
<% end %>

<%# // Decide if we should show the Stripe button ------------------------ %>
<% show_button = !@order.paid? %>  <!-- // show only when NOT paid -->

<% if show_button %>
  <div class="d-grid gap-2">
    <%= button_to "Pagar com cartão (Stripe • teste)",
                  checkout_sessions_path,
                  method: :post,
                  params: { order_id: @order.id },
                  class: "btn btn-success btn-lg",
                  form: { data: { turbo: false } } %>  <!-- // non-Turbo POST to follow Stripe redirect -->
    <small class="text-muted">
      Você será redirecionado para a página de pagamento segura da Stripe.
    </small>
  </div>
<% else %>
  <div class="alert alert-info mb-0">
    Este pedido não está pendente de pagamento.
  </div>
<% end %>

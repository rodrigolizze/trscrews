<!-- app/views/screws/_card.html.erb -->
<!-- Reusable product card for a single `screw` (use: render "card", screw: screw) -->
<div class="card h-100 shadow-sm">

  <!-- Image area with a fixed 1:1 ratio so all cards align nicely -->
  <div class="ratio ratio-1x1 bg-white d-flex align-items-center justify-content-center">
    <% if screw.images.attached? %>
      <%= image_tag screw.images.first.variant(resize_to_limit: [600, 600]),
                    class: "img-fluid p-2",
                    style: "object-fit: contain;",
                    alt: screw.description,
                    loading: "lazy",
                    decoding: "async" %>
    <% else %>
      <div class="text-muted small p-3">Sem imagem</div>
    <% end %>
  </div>

  <div class="card-body d-flex flex-column">
    <!-- Small spec line -->
    <small class="text-muted"><%= screw.thread %> - <%= screw.surface_treatment %></small>

    <!-- Title/description -->
    <h6 class="mt-1 mb-2"><%= screw.description %></h6>

    <!-- Bottom row sticks to the bottom thanks to mt-auto -->
    <div class="mt-auto d-flex align-items-center justify-content-between">
      <strong><%= format_price(screw.price) %></strong>

      <div class="d-flex align-items-center gap-2">
      <%# // Stock badge: shows when 0 %>
        <% if screw.out_of_stock? %>
          <span class="badge bg-secondary">Indispon√≠vel</span>
        <% end %>

        <%= link_to "Ver", screw_path(screw), class: "btn btn-sm btn-outline-dark" %>

        <!-- Add 1 unit (disabled if no stock) and go to the cart -->
        <% if screw.in_stock? %>
          <%= button_to "Add",
                        add_cart_path(screw_id: screw.id),
                        method: :post,
                        params: { quantity: 1 },
                        class: "btn btn-sm btn-yellow" %>
        <% else %>
          <button class="btn btn-sm btn-secondary" disabled>Adicionar</button>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container py-4" data-controller="gallery">
  <div class="mb-3">
    <%= link_to "← Voltar ao catálogo", screws_path, class: "text-decoration-none" %>
  </div>

  <div class="row gx-2 gy-4 align-items-start">
    <%# Left: thumbnails %>
    <div class="col-12 col-md-auto order-2 order-md-1 d-none d-md-flex flex-column gap-2">
      <% if @screw.images.attached? %>
        <% @screw.images.each do |img| %>
          <a href="#" class="d-inline-block"
            data-action="click->gallery#swap"
            data-gallery-target="thumb"
            data-url="<%= url_for(img.variant(resize_to_limit: [1000, 1000])) %>">
            <%= image_tag img.variant(resize_to_limit: [200, 200]),
            class: "rounded border opacity-75",
            style: "width: 72px; height: 72px; object-fit: cover;",
            alt: @screw.description %>
          </a>
        <% end %>
      <% end %>
    </div>

    <%# Right: main image + details %>
    <div class="col-12 col-md order-1 order-md-2">
      <div class="row gx-2 gy-4 align-items-start">
        <div class="col-md-7">
          <% if @screw.images.attached? %>
            <%= image_tag @screw.images.first.variant(resize_to_limit: [1000, 1000]),
              data: { gallery_target: "main" },
              class: "img-fluid rounded shadow-sm w-100",
              style: "max-height: 460px; object-fit: contain; background: #fff;",
              alt: @screw.description %>
          <% else %>
            <div class="bg-light d-flex align-items-center justify-content-center rounded"
                 style="height: 360px;">
              <span class="text-muted">Sem imagens</span>
            </div>
          <% end %>
        </div>
        
      <%# Optional: show thumbnails below on mobile %>
      <div class="d-md-none mt-3 d-flex gap-2 overflow-auto">
        <% if @screw.images.attached? %>
          <% @screw.images.each do |img| %>
            <a href="#" class="d-inline-block"
              data-action="click->gallery#swap"
              data-gallery-target="thumb"
              data-url="<%= url_for(img.variant(resize_to_limit: [1000, 1000])) %>">
              <%= image_tag img.variant(resize_to_limit: [200, 200]),
                    class: "rounded border opacity-75",
                    style: "width: 72px; height: 72px; object-fit: cover;",
                    alt: @screw.description,
                    loading: "lazy",
                    decoding: "async" %>
            </a>
          <% end %>
        <% end %>
      </div>

        <div class="col-md-5">
          <small class="text-muted"><%= @screw.thread %> — <%= @screw.surface_treatment %></small>
          <h3 class="fw-bold mt-1"><%= @screw.description %></h3>
          <p class="mb-1 text-muted"><%= @screw.automaker %> - <%= @screw.model %></p>

          <hr>

          <dl class="row small">
            <% {
              "Rosca" => @screw.thread,
              "Comprimento da rosca" => @screw.thread_length,
              "Classe de resistência" => @screw.resistance_class,
              "Tratamento" => @screw.surface_treatment,
              "Montadora" => @screw.automaker,
              "Modelo" => @screw.model
            }.each do |label, value| %>
              <% next if value.blank? %>
              <dt class="col-6 text-muted"><%= label %></dt>
              <dd class="col-6"><%= value %></dd>
            <% end %>
          </dl>

          <div class="p-3 bg-light rounded d-flex align-items-center justify-content-between my-3">
            <div class="fs-4 fw-bold"><%= format_price(@screw.price) %></div>
            <%= button_to "COMPRAR", "#", class: "btn btn-yellow px-4", method: :post %>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
